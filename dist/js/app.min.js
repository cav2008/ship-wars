var APP=function(t){function e(e){var n=[];this.createSquares=function(e){for(var i=e*e,r=0;i>r;r++){var o=new t.Square(r);n.push(o)}},this.getSquares=function(){return n},this.getSquare=function(t){return n[t]},this.createSquares(e)}return t.Board=e,t}(APP||{}),APP=function(t){function e(){function e(){for(var t=0;t<h.length;t++){var e=h[t].getId(),n=!1;for(f(e);!n;){var i=o();n=this.setShipLocation(i,e)}}}function n(t,e){var n=this.getShip(e).getHitPoint(),i=this.getShip(e).getHorizontal(),r=t;if(i){var o=r+(n-1),a=10*Math.trunc(r/10)+9,u=[];if(a>=o){for(var s=0;n>s;s++){var h=r+s;u.push(h)}return u}return u}var o=r+10*(n-1),c=99,u=[];if(c>=o){for(var s=0;n>s;s++){var h=r+10*s;u.push(h)}return u}return u}function i(t){if(t.length<=0)return!0;for(var e=0;e<t.length;e++)if(this.getBoard().getSquare(t[e]).getOccupied()===!0)return!0;return!1}function r(t){Math.round(Math.random())&&this.getShip(t).rotate()}function o(){return Math.round(100*Math.random())}var a,u,s,h=[],c=n.bind(this),d=i.bind(this),f=r.bind(this),g=e.bind(this),p=[{id:0,name:"Aircraft Carrier",hp:6},{id:1,name:"Helicopter Carrier",hp:4},{id:2,name:"Battle Cruiser",hp:4},{id:3,name:"Destroyer",hp:4},{id:4,name:"Frigate",hp:2},{id:5,name:"Patrol Boat",hp:2}];this.setupGame=function(){a=new t.Board(10),s=new t.Weapon("torpedo",50),u=new t.Player(1,!1,s);for(var e=0;e<p.length;e++){var n=new t.Ship(p[e].id,p[e].name,p[e].hp);h.push(n)}g()},this.setShipLocation=function(t,e){var n=c(t,e);if(d(n)===!1){for(var i=0;i<n.length;i++){var r=a.getSquare(n[i]);r.placeShip(e)}return!0}return!1},this.checkGameOver=function(){for(var t=this.getPlayer().getTorp().getAmmo(),e=!1,n=0;n<h.length;n++)if(0!==h[n].getHitPoint()){e=!0;break}return 0===t&&e===!0?"LOSE":t>=0&&e===!1?"WIN":void 0},this.getShip=function(t){return h[t]},this.getShips=function(){return h},this.getBoard=function(){return a},this.getPlayer=function(){return u},this.setupGame()}return t.Game=e,t}(APP||{}),APP=function(t){function e(t,e,n){var i=n;this.getTorp=function(){return i},this.fire=function(t){"torpedo"===t&&i.decrease()}}return t.Player=e,t}(APP||{}),APP=function(t){function e(t,e,n){var i=t,r=e,o=n,a=n,u=!1,s=!1;this.rotate=function(){u=!0},this.reduceHitPoint=function(){--a},this.getId=function(){return i},this.getName=function(){return r},this.getHitPoint=function(){return a},this.getHorizontal=function(){return u},this.getMaxHP=function(){return o},this.alertDestroyed=function(){if(s===!1&&0===a){var t=r+" has been destroyed!";return s=!0,t}}}return t.Ship=e,t}(APP||{}),APP=function(t){function e(){var t=new Audio("dist/sound/explosion.mp3"),e=new Audio("dist/sound/hit.mp3"),n=new Audio("dist/sound/miss.mp3"),i=new Audio("dist/sound/game-over-theme.mp3"),r=new Audio("dist/sound/urf-win.mp3"),o={explosion:t,hit:e,miss:n,"game over":i,win:r};this.playSound=function(t){o[t].play()},this.missSound=function(){this.playSound("miss")},this.hitSound=function(){this.playSound("hit")},this.destroyedSound=function(){this.playSound("explosion")},this.winSound=function(){this.playSound("win")},this.gameOverSound=function(){this.playSound("game over")}}return t.Sound=e,t}(APP||{}),APP=function(t){function e(t){var e,n=t,i=!1;this.reveal=function(){i=!0},this.placeShip=function(t){e=t},this.getId=function(){return n},this.getClicked=function(){return i},this.getOccupied=function(){return void 0!==e?!0:!1},this.getShipId=function(){return e}}return t.Square=e,t}(APP||{}),APP=function(t){function e(){function t(){e(),null==o&&(n("fire",50),n("won",0),n("lost",0),n("combo",0))}function e(){i=localStorage.getItem("won"),r=localStorage.getItem("lost"),o=localStorage.getItem("combo")}function n(t,e){localStorage.setItem(t,e)}var i,r,o;t(),this.save=function(t,a,u){"win"===a?n("won",++i):n("lost",++r),u>o&&n("combo",u),e()},this.getGamesWon=function(){return i},this.getGamesLost=function(){return r},this.getCombo=function(){return o}}return t.Stats=e,t}(APP||{}),APP=function(t){function e(t,e){var n=e;this.getAmmo=function(){return n},this.decrease=function(){--n}}return t.Weapon=e,t}(APP||{});$(document).ready(function(){function t(){$(".tNumber").text(o.getTorp().getAmmo());for(var t=i.getShips(),e=0;e<t.length;e++){var n=".ship-"+t[e].getId();$(n+" .ship-name").text(i.getShip(e).getName()),$(n+" .ship-hp-now").text(i.getShip(e).getHitPoint());var r=t[e].getHitPoint()/t[e].getMaxHP()*100;0===r?$(n+" .progress-bar").width("100%").addClass("progress-bar-danger").removeClass("progress-bar-success"):$(n+" .progress-bar").width(r+"%")}}function e(){$(".lowest-torp-fire").text(u.getLowestTorpFire()),$(".games-won").text(u.getGamesWon()),$(".games-lost").text(u.getGamesLost()),$(".combo").text(u.getCombo())}function n(){for(var t=i.getShips(),n=0;n<t.length;n++){var r=".ship-"+t[n].getId();$(r+" .ship-hp-max").text(i.getShip(n).getHitPoint())}e()}var i=new APP.Game,r=i.getBoard(),o=i.getPlayer(),a=new APP.Sound,u=new APP.Stats,s=0,h=0;n(),t(),$(".square").click(function(){var n=$(this).data("id"),c=r.getSquare(n);if(c.getClicked())console.log("You already fired there fool!");else if(c.reveal(),o.fire("torpedo"),c.getOccupied()===!0){var d=i.getShip(c.getShipId());d.reduceHitPoint(),$(this).addClass("hit"),a.hitSound();var f=d.alertDestroyed();if(f){var g=".ship-"+c.getShipId()+" .ship-name";$(g).addClass("destroyed"),a.destroyedSound()}h++}else $(this).addClass("miss"),a.missSound(),h>s&&(s=h),h=0;t(),("WIN"===i.checkGameOver()||"LOSE"===i.checkGameOver())&&("WIN"===i.checkGameOver()?(a.winSound(),window.alert("You win! You are the captain now!"),u.save("win",s)):(window.alert("You Lose! (and you suck)"),a.gameOverSound(),u.save("lose",s)),e())}),$(".reset-btn").click(function(){window.location.reload()})});